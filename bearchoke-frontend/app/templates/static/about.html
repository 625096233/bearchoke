<!--
  ~ Copyright 2014 the original author or authors.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~      http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="jumbotron">
    <div class="container">
        <h2><i class="fa fa-stack-exchange"></i> Bearchoke Tempest Tech Stack</h2>
        <p>A detailed overview of the tech stack including how to get up and running</p>
    </div>
</div>
<div class="container">

<p>Welcome to Bearchoke Tempest. This platform aims to be a best practices framework using the latest Java based frameworks, Enterprise Integration Patterns (EIP) and specifically focusing on using an asynchronous, message based, event driven approach to creating web-based software. The current push in the user interface space is SPA/SPI (Single Page Applications / Single Page Interface). The samples will leverage AngularJS to showcase this. Bearchoke Tempest was created to show how an SPA can interface with the Spring server world as well as leverage other SPA modular goodies.</p>

<p>If you just want to check out the demo, you can check out the Cloud Foundry hosted instance here: <a href="http://www.bearchoke.com">www.bearchoke.com</a>.</p>

<p>Key frameworks that I've leveraged to make this work are:</p>

<ul>
    <li>Spring</li>
    <li>Spring Integration</li>
    <li>Spring AMQP</li>
    <li>Redis</li>
    <li>Axon CQRS Framework</li>
    <li>Rabbit MQ</li>
    <li>Web Socket</li>
</ul>


<p>Another key focus has been on the separation of front-end and back-end technologies. This was born out of the requirement to "build for mobile first". To the layman, it means that we want to avoid building more than one way of accessing our service endpoints. It should be the same calls being made in the browser as in a native mobile application.</p>

<p>Below, I will cover what is required to get up and running using all the goodies available on the platform. But first, here is the list of technologies and frameworks the platform uses to get the job done.</p>

<h2>Back-end Technologies</h2>

<ul>
    <li><a href="http://projects.spring.io/spring-framework/">Spring Framework</a> (Inversion of Control IoC)</li>
    <li>Spring Web MVC (Part of Spring Framework: REST mappings)</li>
    <li>Spring Web Socket (Part of Spring Framework: Web Socket mappings)</li>
    <li><a href="http://projects.spring.io/spring-security/">Spring Security</a> (security + authentication)</li>
    <li><a href="http://projects.spring.io/spring-integration/">Spring Integration</a> (Enterprise Integration Patterns EIP and implementations)</li>
    <li><a href="http://projects.spring.io/spring-data-mongodb">Spring Data MongoDb</a> (Persistence layer to MongoDb)</li>
    <li><a href="http://projects.spring.io/spring-data-jpa">Spring Data Jpa</a> (Persistence layer to Jpa)</li>
    <li><a href="http://projects.spring.io/spring-data-redis">Spring Data Redis</a> (Persistence layer to Redis)</li>
    <li><a href="https://github.com/spring-projects/spring-session">Spring Session</a> (for easier persisting session for REST / Web Socket based clients)</li>
    <li><a href="http://www.axonframework.org">Axon Framework</a> (Command Query Responsibility Segmentation CQRS)</li>
    <li><a href="http://jasypt.org/">Jasypt</a> (Encryption)</li>
    <li><a href="https://github.com/RichardHightower/boon">Boon</a> &amp; <a href="https://github.com/FasterXML/jackson">Jackson</a> (JSON transformation)</li>
</ul>


<h2>Databases and Queues</h2>

<ul>
    <li><a href="http://www.mongodb.org">MongoDb</a></li>
    <li><a href="http://dev.mysql.com">MySQL</a> / <a href="http://www.postgresql.org">PostgreSQL</a> / <a href="http://db.apache.org/derby/">DerbyDb</a> or any other RDBMS with a Java driver</li>
    <li><a href="http://www.redis.io">Redis</a></li>
    <li><a href="http://www.rabbitmq.com">RabbitMQ</a></li>
</ul>


<h2>Front-end Technologies</h2>

<ul>
    <li><a href="http://www.angularjs.org">AngularJS</a> (MVC and IoC framework in javascript)</li>
    <li><a href="http://www.linemanjs.com">Lineman</a> (Build and test tool)</li>
    <li><a href="http://www.gruntjs.com">Grunt</a> (Dependency management for Javascript)</li>
    <li>Web Socket using <a href="https://github.com/sockjs">SockJS</a> + <a href="http://stomp.github.io/">Stomp</a> sub-protocol</li>
    <li><a href="http://getbootstrap.com/">Bootstrap</a> (Responsive web framework)</li>
</ul>


<h2>Version Control</h2>

<ul>
    <li><a href="https://www.github.com">Github</a> <a href="https://github.com/bjornharvold/bearchoke">https://github.com/bjornharvold/bearchoke</a></li>
</ul>


<h2>IDE, Build &amp; Deployment Tools</h2>

<ul>
    <li><a href="http://www.jetbrains.com/idea/">JetBrains IntelliJ IDEA</a> (Integrated Development Environment IDE)</li>
    <li><a href="http://maven.apache.org">Maven</a> (Dependency management)</li>
    <li><a href="http://www.pivotal.io/platform-as-a-service/pivotal-cf">Pivotal Cloud Foundry</a> (Scalable Platform as a Service PaaS)</li>
</ul>


<h2>Project Management Tools</h2>

<ul>
    <li><a href="https://github.com/bjornharvold/bearchoke/issues">Github</a> (Issue tracking)</li>
    <li><a href="https://github.com/bjornharvold/bearchoke/wiki">Github</a> (Wiki)</li>
</ul>


<h2>Requirements</h2>

<ul>
    <li>Maven v3.2.3+</li>
    <li>Redis v2.8.13+</li>
    <li>RabbitMQ v3.3.4+</li>
    <li>MongoDb v2.6.4+</li>
    <li>JetBrains IntelliJ v13+</li>
    <li>Lineman (latest)</li>
    <li>Grunt (latest)</li>
</ul>


<h2>Project Directory Structure</h2>

<ul>
    <li><strong>bearchoke-frontend</strong></li>
    <li><strong>bearchoke-backend</strong></li>
</ul>


<p>From the root directory, you will see two sub-directories: <strong>bearchoke-frontend</strong> and <strong>bearchoke-backend</strong>. These are two distinct Maven projects that should be imported into your IDE separately.</p>

<p><strong>Importing: bearchoke-frontend</strong>
    If you are using IntelliJ, you can just import the project by clicking File - Import Project and selecting the directory bearchoke-frontend. IntelliJ project files have already been committed to Git to support this. If you want to create the project from scratch, you can create a new "Static Web" project and set the root directory to be bearchoke-frontend. That's it!</p>

<p><strong>Importing: bearchoke-backend</strong>
    If you are using IntelliJ, you can just import the project by clicking File - Import Project and selecting the directory bearchoke-backend. IntelliJ project files have already been committed to Git to support this. If you want to import it from scratch, you can choose to import the project from the Maven pom.xml file that is located directly under bearchoke-backend. In case you encounter any issues with third-party dependencies, you get more information about the error if you run the initial Maven project compilation from your Terminal / Command Prompt. Go into bearchoke-backend and type:</p>

<pre><code>$ cd bearchoke-backend
    $ mvn clean install -Dmaven.test.skip=true
</code></pre>

<p>This will download all dependencies and install all Bearchoke libraries in the Maven repository. If you do this before you import the project into IntelliJ, project creation will also be faster as all dependencies have already been downloaded.</p>

<p>When you are set up with your project successfully, install the Project Lombok plugin for IntelliJ.</p>

<h2>Setting up Databases and Queues</h2>

<h2>Redis (required for every type of active spring profile)</h2>

<p><a href="http://www.redis.io">Redis</a> is used by <a href="https://github.com/spring-projects/spring-session">Spring Session</a> to keep a user session over several protocols and devices without needing a cookie (aka JSESSION_ID). Once a user is authenticated, the user can make calls over REST and Web Socket seamlessly.</p>

<p>Download Redis from here: <a href="http://redis.io/download">http://redis.io/download</a>. Once you have it installed, you can start it up from the command line by typing (assuming you have Linux or Mac OSX):</p>

<pre><code>$ redis-server /usr/local/etc/redis.conf
</code></pre>

<h2>RabbitMQ (required for every type of spring profile)</h2>

<p><a href="http://www.rabbitmq.com">RabbitMQ</a> is the AMQP implementation used by Spring Integration to broker messages. RabbitMQ is a message broker. The principal idea is pretty simple: it accepts and forwards messages. You can think about it as a post office: when you send mail to the post box you're pretty sure that Mr. Postman will eventually deliver the mail to your recipient. Using this metaphor RabbitMQ is a post box, a post office and a postman. The major difference between RabbitMQ and the post office is the fact that it doesn't deal with paper, instead it accepts, stores and forwards binary blobs of data â€’ messages. RabbitMQ helps in making the architecture event driven.</p>

<p>Download RabbitMQ from here: <a href="http://www.rabbitmq.com/download.html">http://www.rabbitmq.com/download.html</a>. Once you have it installed, you want to first enable the STOMP protocol for RabbitMQ. Go into your installation directory and type:</p>

<pre><code>$ cd sbin
    $ ./rabbitmq-plugins enable rabbitmq_stomp
</code></pre>

<p>Then you can start RabbitMQ by typing:</p>

<pre><code>$ ./rabbitmq-server start
</code></pre>

<h2>MongoDb (required for 'mongodb' spring profile)</h2>

<p><a href="http://www.mongodb.org">MongoDb</a> is a NoSQL database, more specifically known as a "document store". Install MongoDb and add it to your PATH. I suggest creating a 'data' directory on the same level as bearchoke-backend and bearchoke-frontend and then starting MongoDb up by typing:</p>

<pre><code>$ mongod --dbpath data/ &amp;
</code></pre>

<p>Create a database called 'bearchoke' with credentials: bearchoke / beachoke</p>

<h2>Jpa (required for 'jpa' spring profile)</h2>

<p>Jpa is the standard Java Persistence API. To showcase the framework's Jpa support, we're using an in-memory version of <a href="http://db.apache.org/derby/">DerbyDb</a>. There is no installation necessary.</p>

<h2>Lineman</h2>

<p>In order to install Lineman, you also need to install the latest version of <a href="http://www.nodejs.org/">Node.JS</a>. Once Node.JS is installed, you can install Lineman by typing this in your Terminal / Command Prompt:</p>

<pre><code>$ sudo npm install -g lineman
</code></pre>

<p>The last requirement for Lineman is that you have <a href="http://phantomjs.org/download.html">PhantomJS</a> installed and on your PATH.</p>

<h2>Grunt</h2>

<p>Once you have installed Lineman, Grunt is next. This one is simple. Just type this in your Terminal / Command Prompt:</p>

<pre><code>$ npm install -g grunt-cli
</code></pre>

<h2>Getting Up and Running</h2>

<p>To see a basic web application that showcases the technologies mentioned above, you need to start the bearchoke-server web app and start the bearchoke-frontend app.</p>

<p>The server part was configured for Tomcat 8+. There is no embedded Maven plugin for Tomcat 8 so this app cannot be run from the command line unfortuantely. You will have to create an IntelliJ 'run configuration' where you deploy the bearchoke-server webapp. Set the active profiles for Spring in your environment variables section of your run configuration:</p>

<pre><code>$ -Dspring.profiles.active=in-memory,redis-local,rabbit-local
</code></pre>

<p>Valid local profiles are: in-memory, jpa, mongodb. I won't cover everything it takes to run the different profiles but here are the active spring profiles necessary to run the different local profiles. Follow the different profile names to see what configurations are necessary.</p>

<p>MongoDb</p>

<pre><code>$ -Dspring.profiles.active=mongodb,mongodb-local,redis-local,rabbit-local
</code></pre>

<p>JPA</p>

<pre><code>$ -Dspring.profiles.active=jpa,jpa-local,redis-local,rabbit-local
</code></pre>

<p>Finally, the app has been configured to use a custom domain. Please edit your /etc/hosts file and add dev.bearchoke.com. You can verify that the bearchoke-server web application is running by going to http://dev.bearchoke.com:8080 in your browser.</p>

<p>Next, you have to start the bearchoke-frontend application. Type the following in a new Terminal / Command Prompt window:</p>

<pre><code>$ cd bearchoke-frontend
    $ npm install (will install all dependencies located in package.json)
    $ lineman run
</code></pre>

<p>You can verify that it's running by going to http://dev.bearchoke.com:8000 in your browser. This is the sample app. Enjoy!</p>

<h2>What the Framework Gives You</h2>

<p>There are a few things the Bearchoke Tempest gives you out of the box.</p>

<p><strong>On the backend, the framework gives you:</strong></p>

<ul>
    <li>Spring Security authentication implementations with a device agnostic session manager to help keep state across devices and protocols.</li>
    <li>Spring Social implementations. Current profiles are embedded, mongodb and jpa.</li>
    <li>Beans to help you quickly get set up with using Command Query Responsibility Segregation (CQRS) and Enterprise Integration Patterns (EIP).</li>
    <li>Examples on how to create versioned, REST based, controller request mappings using Spring Web MVC.</li>
    <li>Examples on how to create Web Socket URL mappings using Spring Web Socket with StompJS.</li>
    <li>Spring Profiles so you can choose what type of authentication implementation you want to use. Current profiles are embedded, mongodb and jpa.

        <ul>
            <li>Embedded is a pure in-memory configuration (except you still need to have Redis and RabbitMQ running)</li>
            <li>MongoDb uses MongoDb to store its authentication tokens and user profiles</li>
            <li>Jpa uses DerbyDb to store its authentication tokens and user profiles
                You are not restricted to just using one Spring profile at the time, but it is easier if you choose one persistence implementation and run with it. If your project requires a NoSQL database for example, choose the 'mongodb' profile.</li>
        </ul>
    </li>
</ul>


<p><strong>On the frontend, the framework gives you:</strong></p>

<ul>
    <li>Model-View-Controller and Dependency Injection framework [and much MUCH more] with AngularJS.</li>
    <li>A fully featured build tool with LinemanJS. Much like Maven, it offers code separation. Controllers, views, css, services and third party libraries are all separated into different directories. Lineman concatenates, minifies, uglyfies etc all the javascript and css into 2 files that are then being used by the application. Files you are working on are updated in real-time and you just have to refresh your browser.</li>
    <li>Remember me functionality using local storage</li>
    <li>Bootstrap for building responsive web applications</li>
    <li>Client-side translation using Angular-Translate</li>
    <li>Restangular for use with REST-based server-side calls</li>
    <li>Ui-router to handle your page setup and navigation</li>
    <li>StompJS client for communication via websocket</li>
    <li>Lodash and underscore javascript utility libraries</li>
    <li>Template based views with AngularJS</li>
    <li>Javascript code separation with Lineman. Controllers, views, css, services and third party libraries are all separated into different directories. Lineman concatenates, minifies, uglyfies etc all the javascript and css into 2 files that are then being used by the application.</li>
    <li>Existing services handle Facebook authentication, remember me, MixPanel analytics, local storage</li>
    <li><a href="http://lesscss.org/">Less CSS</a> is a CSS pre-processor that adds new features that allow variables, mixins, functions and many other techniques that allow you to make CSS that is more maintainable, themable and extendable.</li>
</ul>


<h2>Current release</h2>

<p>2014-10-16 - 0.0.1 Initial version</p>

<h2>Next release features</h2>

<p>This framework is for me a way to prove that the technologies can co-exist together [peacefully] and that they work and are testable. As my other projects require new features, I will add these here first as a test bed. Upcoming features I already want to add are:</p>

<ul>
    <li>Facebook integration</li>
    <li>MixPanel integration</li>
    <li>File upload example</li>
    <li>Charting and reporting</li>
    <li>Tests, tests and tests</li>
</ul>


<p>If you would like to commit to this project you are more than welcome to do so. You can message me on Twitter at @bjornharvold or on Github.</p>
</div>